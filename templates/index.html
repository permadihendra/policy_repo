<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Policy Repository Admin</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
    </head>
    <body>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">Policy Repository</a>
                <div class="collapse navbar-collapse">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link active" href="/"
                                >Upload Policy</a
                            >
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#search">Search</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container mt-4">
            <!-- Upload Section -->
            <section id="upload">
                <h3>Upload Policy Document</h3>
                <form id="uploadForm" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="policyTitle" class="form-label"
                            >Select PDF or DOCX</label
                        >
                        <input
                            class="form-control"
                            type="text"
                            id="policyTitle"
                            name="title"
                        />
                    <div class="mb-3">
                        <label for="policyFile" class="form-label"
                            >Select PDF or DOCX</label
                        >
                        <input
                            class="form-control"
                            type="file"
                            id="policyFile"
                            name="policy"
                        />
                    </div>
                    <button type="submit" class="btn btn-primary">
                        Upload
                    </button>
                </form>
            </section>

            <hr />

            <!-- Search Section -->
            <section id="search">
                <h3>Search Policies</h3>
                <div class="input-group mb-3">
                    <input
                        type="text"
                        class="form-control"
                        placeholder="Enter keyword..."
                        id="searchInput"
                    />
                    <button
                        class="btn btn-outline-secondary"
                        type="button"
                        onclick="searchPolicies()"
                    >
                        Search
                    </button>
                </div>
                <ul class="list-group" id="searchResults"></ul>
            </section>

            {% if policies %}
            <section id="list_policy">
                <h3>List Policies</h3>
                <table class="table">
                  <thead>
                    <tr>
                      <th scope="col">#</th>
                      <th scope="col">Title</th>
                      <th scope="col">Content</th>
                      <th scope="col">uploaded_at</th>
                      <th scope="col">Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for policy in policies %}
                    <tr>
                      <th scope="row">{{ policy.id }}</th>
                      <td>{{ policy.title }}</td>
                      <td>{{ policy.title }}</td>
                      <td>{{ policy.uploaded_at }}</td>
                       <td>
                           <a href="#">edit</a>
                           <a href="#">delete</a>
                       </td>
                    </tr>
                    {% endfor %}
                  </tbody>
            </section>
            {% endif %}

            {% if results %}
            <section id="list_policy">
                <h3>Search Result Policies</h3>
                <table class="table">
                  <thead>
                    <tr>
                      <th scope="col">#</th>
                      <th scope="col">Title</th>
                      <th scope="col">Score</th>
                      <th scope="col">Excerpt</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for result in results %}
                    <tr>
                      <th scope="row">{{ result["id"] }}</th>
                      <td>{{ result["title"] }}</td>
                      <td>{{ result["score"] }}</td>
                      <td>{{ result["excerpt"] }}</td>
                    </tr>
                    {% endfor %}
                  </tbody>
            </section>
            {% endif %}
        </div>

        <script>
            // Upload handler
            document
                .getElementById("uploadForm")
                .addEventListener("submit", async function (e) {
                    e.preventDefault();
                    const formData = new FormData(this);
                    const res = await fetch("/upload", {
                        method: "POST",
                        body: formData,
                    });
                    alert((await res.json()).message);
                });

            // Search handler
            function searchPolicies() {
                const query = document.getElementById("searchInput").value;
                if (!query) return;
                window.location.href = `/search?query=${encodeURIComponent(query)}`;
            }
        </script>
    </body>
</html>
